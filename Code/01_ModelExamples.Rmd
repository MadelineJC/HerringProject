# Coding Dynamical Models

## Example 1: The Ricker Model

The Ricker model can be written as follows:

$$
N_{t} = N_{t-1}e^{r(1-\frac{N_{t-1}}{k})}
$$

Where:

$N$ is population size;

$r$ is the intrinsic growth rate of the population;

$k$ is the carrying capacity of the population.

The model gives the population size/density, $N$, at time $t$, as a function of the population size/density at time $t-1$.

The Ricker model is a discrete-time model, and can be coded as follows:

```{r}
r <- 0.1
k <- 1000
t <- seq(0, 100, 1)
N <- c(); N[1] <- 5

for (i in 2:length(t)){
  N[i] <- N[i-1]*exp(r*(1-(N[i-1]/k)))
}

plot(N, xlab = "Time", ylab = "Population Abundance (N)", type = "l")
legend("bottomright", legend = c("r = 0.1"),
       col = c("black"), lwd = 2)
```

Notice that the population settles around $N=k$.

Let's play with the intrinsic growth rate, $r$.

```{r}
r <- c(0.1, 0.2, 0.3, 0.5, 1, 1.1, 1.2, 1.5, 2, 3, 4, 5)
N_df <- c()
for (i in 1:length(r)){
  N <- c(); N[1] <- 5
  for (j in 2:length(t)){
    N[j] <- N[j-1]*exp(r[i]*(1-(N[j-1]/k)))
  }
  N_df <- cbind(N_df, N)
}

## Plotting
col <- c("red4", "red3", "orange1", "gold", "#00CC99", "#009966", "#66CCFF", "#003399", "#330066", "#CC99FF", "#FF99FF", "#CC0066")
main <- c("r = 0.1", "r = 0.2", "r = 0.3", "r = 0.5", "r = 1.0", "r = 1.1",
          "r = 1.2", "r = 1.5", "r = 2.0", "r = 3.0", "r = 4.0", "r = 5.0")
for (i in 1:ncol(N_df)){
  plot(N_df[ ,i], col = col[i], type = "l", lwd = 2,
       main = main[i], xlab = "Time", ylab = "Population Abundance (N)")
}
```

## Example 2: Rosenzweig-MacArthur Model

The Rosenzweig-MacArthur model is an extended version of the Lotka-Volterra model. It considers density-dependent growth of the prey species, and incorporates a functional response, as developed by Holling.

$
\frac{dN}{dt} = (b-d)N(1-\frac{n}{k})-\frac{\alpha N}{1+wN}P \\
\frac{dP}{dt} = P(c\frac{\alpha N}{1+wN}-g)
$

$b$ is the birth rate of the prey species;

$d$ is the death rate of the prey species;

$k$ is the carrying capacity of the prey species;

$\alpha$ is the predation efficiency;

$w$ measures the degree of predator saturation;

$c$ is the conversion efficiency of the predator;

$g$ is the per capita death rate of the predator.

The Rosenzweig-MacArthur model is a continuous-time model. We can use the package `deSolve` to solve ODEs (ordinary differential equations), as so:

```{r}
# install.packages(deSolve)
library(deSolve)
RosenMacModel <- function(t, y, p){
  b <- p[1]; d <- p[2]; k <- p[3]; a <- p[4] 
  w <- p[5]; c <- p[6]; g <- p[7] # Parameters that define the model
  N <- y[1]; P <- y[2] # State variables (what's changing over time/space, etc.)
  dN = (b - d)*N*(1 - (N/k)) - (a*N)/(1 + w*N)*P # Prey abundance over time
  dP = P*(c*(a*N)/(1 + w*N) - g) # Predator abundance over time
  list(c(dN, dP))
}
b <- 2; d <- 1; k <- 1000; a <- 0.005; w <- 0.0025; c <- 2;g <- 2 # Parameter values
parms <- c(b, d, k, a, w, c, g)
N0 <- 500; P0 <- 500 # Initial conditions/state of the system
N0 <- c(N0, P0)
TT <- seq(0, 100, 0.1) # Time series over which to solve, and with what step size
results <- lsoda(N0, TT, RosenMacModel, parms, verbose = FALSE)
RosenMacDet <- data.frame(results); colnames(RosenMacDet) <- c("Time", "N", "P")
plot(RosenMacDet$Time, RosenMacDet$N, col = "orchid", lwd = 2,
     type = "l", ylim = c(0, 800),
     main = "Deterministic Simulation of the Rosenzweig-MacArthur Model", 
     xlab = "Time", ylab = "Population Abundance")
lines(RosenMacDet$Time, RosenMacDet$P, col = "cornflowerblue", lwd = 2)
legend("topright", legend = c("Prey (N)", "Predator (P)"), col = c("orchid", "cornflowerblue"), lwd = 2)
```

Let's see what happens if we play around with parameter values:

```{r}
a <- 0.008 # Increase attack rate to 0.008
parms <- c(b, d, k, a, w, c, g)
N0 <- 500; P0 <- 500 # Initial conditions/state of the system
N0 <- c(N0, P0)
TT <- seq(0, 200, 0.1) # Time series over which to solve, and with what step size
results <- lsoda(N0, TT, RosenMacModel, parms, verbose = FALSE)
RosenMacDet <- data.frame(results); colnames(RosenMacDet) <- c("Time", "N", "P")
plot(RosenMacDet$Time, RosenMacDet$N, col = "orchid", lwd = 2,
     type = "l", ylim = c(0, max(RosenMacDet[ , 2:3])),
     main = "Deterministic Simulation of the RM Model: Higher Attack Rat", 
     xlab = "Time", ylab = "Population Abundance")
lines(RosenMacDet$Time, RosenMacDet$P, col = "cornflowerblue", lwd = 2)
legend("topright", legend = c("Prey (N)", "Predator (P)"), col = c("orchid", "cornflowerblue"), lwd = 2)

a <- 0.004 # Decrease attack rate to 0.004
parms <- c(b, d, k, a, w, c, g)
N0 <- 500; P0 <- 500 # Initial conditions/state of the system
N0 <- c(N0, P0)
TT <- seq(0, 50, 0.1) # Time series over which to solve, and with what step size
results <- lsoda(N0, TT, RosenMacModel, parms, verbose = FALSE)
RosenMacDet <- data.frame(results); colnames(RosenMacDet) <- c("Time", "N", "P")
plot(RosenMacDet$Time, RosenMacDet$N, col = "orchid", lwd = 2,
     type = "l", ylim = c(0, max(RosenMacDet[ , 2:3])),
     main = "Deterministic Simulation of the RM Model: Lower Attack Rate", 
     xlab = "Time", ylab = "Population Abundance")
lines(RosenMacDet$Time, RosenMacDet$P, col = "cornflowerblue", lwd = 2)
legend("topright", legend = c("Prey (N)", "Predator (P)"), col = c("orchid", "cornflowerblue"), lwd = 2)
```

Notice how the dynamical behaviour of the model changes... When we increase the attack rate, we see out damped oscillations morph into a stable limit cycle that prevents the population from establishing equilibrium. When we decrease the attack rate, we see the prey population settle at a higher equilibrium value. We can work with the model to find an expression that defines this equilibrium (when $\frac{dN}{dt} = \frac{dP}{dt} = 0$).

## Example 3: MacCall et al., 2019 Model

MacCall et al. compare two models of the spatial distribution of recruits. In the first model (DIFF), recruits are distributed in fixed proportions among neighbouring habitats and tend to home to those spawning locations without regard to the presence of older fish. In the second model ("Go With the Older Fish", GWOF), recruits join a school of older fish and adopt that school's behaviour. As such, in the GWOF model, recruits adopt spawning sites in proportion to the relative abundances of the older fish using those habitats. In both cases, many recruits return to their natal sites, but the probabilistic nature by which this happens, differs.

MacCall et al. propose meta-population-esque models, whereby we model biomass by site and time. For example, Equation (1) gives spawner biomass at site $i$ at time $t$ ($B_{i, t}$) as a function of adult biomass ($S$), recruit biomass ($R$), and exploitation ($E$) at the previous time step.

$
(1) B_{i, t} = S_i(\underline B_{t-1}) + R_i(\underline B_{t-1}) - E_{t-1}B_{i,t-1}
$

In Equation (1), $\underline B_t$ refers to the vector of spawning biomass, over $N$ sites, in year $t$.

```{r}

```
